<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>LoG | 次世代テキストベースSNSプロトコル</title>
    <meta name="description" content="LoG（ログ）は、中学生が開発したテキスト限定のシンプルなSNS。90日で自動消去されるログを通じて、今この瞬間の思考を共有しよう。">
    <meta name="google-site-verification" content="Z2rHXTn9RZClgr4XgNlPX0di9h8peZXKxsakNEp9v-E" />

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1539164935971262" crossorigin="anonymous"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        body { background-color: #000; color: #fff; font-family: 'Courier New', monospace; }
        .hidden { display: none; }
        .btn-primary { background-color: #fff; color: #000; font-weight: bold; border-radius: 4px; padding: 10px 16px; transition: 0.2s; }
        .btn-outline { border: 1px solid #333; color: #888; border-radius: 4px; padding: 8px 12px; font-size: 0.9em; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; display: flex; align-items: center; justify-content: center; }
        .terms-scroll { max-height: 300px; overflow-y: auto; background: #0a0a0a; padding: 15px; border: 1px solid #222; font-size: 0.8em; color: #ccc; }
        input, textarea { background-color: #0d0d0d !important; border: 1px solid #222 !important; color: #fff !important; }
    </style>
</head>
<body>

    <div id="login-screen" class="min-h-screen flex flex-col items-center p-6 text-center">
        <div class="mt-20 mb-10">
            <h1 class="text-7xl font-bold mb-2 tracking-tighter">LoG</h1>
            <p class="text-gray-500 text-sm tracking-widest uppercase">Protocol v1.1 / Shiga-Minakuchi Node</p>
        </div>

        <div class="w-full max-w-xs space-y-3 mb-10 bg-zinc-950 p-6 rounded-lg border border-zinc-900">
            <h2 class="text-xs font-bold text-gray-400 mb-4 uppercase">Session Start</h2>
            <input id="auth-email" type="email" placeholder="Email / ID" class="w-full rounded p-3">
            <input id="auth-password" type="password" placeholder="Password" class="w-full rounded p-3">
            <div class="flex gap-2">
                <button id="email-login-btn" class="flex-1 btn-primary text-sm">LOGIN</button>
                <button id="email-signup-btn" class="flex-1 btn-outline text-sm">SIGNUP</button>
            </div>
            <button id="google-login-btn" class="w-full border border-gray-800 py-2 rounded text-xs text-gray-500 mt-4 flex justify-center items-center gap-2">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-3 h-3"> Google Auth
            </button>
        </div>

        <div class="max-w-2xl text-left space-y-8 border-t border-zinc-900 pt-10 mb-20">
            <section>
                <h3 class="text-xl font-bold text-white mb-3">LoGとは？</h3>
                <p class="text-gray-400 leading-relaxed text-sm">
                    LoGは、装飾を削ぎ落とした「テキストのみ」のコミュニケーションプロトコルです。
                    画像や動画による情報の過多から解放され、純粋な言葉のやり取りを目的として開発されました。
                    滋賀県甲賀市の学生開発者によって運営されている実験的プロジェクトです。
                </p>
            </section>

            <section>
                <h3 class="text-xl font-bold text-white mb-3">3つの特徴</h3>
                <ul class="text-gray-400 text-sm space-y-2 list-disc list-inside">
                    <li><strong class="text-white">Ephemeral Log:</strong> 全ての投稿は90日後に自動的に消去され、過去に縛られない対話を実現します。</li>
                    <li><strong class="text-white">Minimal Interface:</strong> 集中を妨げる複雑なUIを排除し、思考の即時記録に特化しています。</li>
                    <li><strong class="text-white">Privacy First:</strong> 独自のIDシステムと匿名性を重視した設計で、自由な発言をサポートします。</li>
                </ul>
            </section>

            <p class="text-[10px] text-gray-600 text-center">
                <span class="underline cursor-pointer hover:text-gray-400" onclick="openTerms()">利用規約・プライバシーポリシー</span> を確認して開始してください。
            </p>
        </div>
    </div>

    <div id="app-screen" class="hidden max-w-xl mx-auto min-h-screen border-x border-gray-900 relative pb-24">
        <header class="sticky top-0 bg-black/95 backdrop-blur z-10 border-b border-gray-900 p-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold tracking-tighter cursor-pointer" onclick="switchTab('home')">LoG</h1>
            <img id="header-icon" src="" class="w-8 h-8 rounded bg-gray-900 cursor-pointer border border-gray-800" onclick="switchTab('profile')">
        </header>

        <div id="tab-home">
            <div class="p-4 border-b border-gray-900 flex gap-3">
                <img id="input-icon" src="" class="w-10 h-10 rounded bg-gray-900">
                <div class="flex-1">
                    <textarea id="post-text" rows="3" placeholder="Input transmission..." class="w-full text-lg resize-none mb-2 p-3 rounded"></textarea>
                    <div class="flex justify-end"><button id="post-btn" class="btn-primary px-8">COMMIT</button></div>
                </div>
            </div>
            <div id="timeline" class="divide-y divide-gray-900"></div>
        </div>

        <div id="tab-profile" class="hidden">
            <div class="p-8 border-b border-gray-900">
                <div class="flex justify-between items-start mb-6">
                    <img id="profile-big-icon" src="" class="w-24 h-24 rounded bg-gray-900 border border-gray-800 shadow-2xl">
                    <button onclick="openProfileEditor()" class="btn-outline">Modify Identity</button>
                </div>
                <h2 id="profile-name" class="text-3xl font-bold tracking-tight"></h2>
                <button onclick="signOutApp()" class="text-[9px] text-red-900 mt-4 block">TERMINATE_SESSION</button>
            </div>
            <div id="my-timeline" class="divide-y divide-gray-900"></div>
        </div>

        <nav class="fixed bottom-0 w-full max-w-xl bg-black/90 border-t border-gray-900 flex justify-around p-4 text-gray-600">
            <button onclick="switchTab('home')" class="hover:text-white"><span class="material-icons text-3xl">terminal</span></button>
            <button onclick="switchTab('profile')" class="hover:text-white"><span class="material-icons text-3xl">fingerprint</span></button>
        </nav>
    </div>

    <div id="terms-modal" class="modal-overlay hidden">
        <div class="bg-black border border-gray-800 p-6 rounded max-w-md w-full m-4">
            <h2 class="text-xs font-bold mb-4 tracking-widest text-gray-400 uppercase">Legal Compliance</h2>
            <div class="terms-scroll mb-6">
                <p class="font-bold text-gray-300">[1] プライバシーポリシー</p>
                <p class="mb-4">本サイトでは、広告配信のためにGoogle AdSenseを利用しています。Google等の第三者配信事業者は、Cookieを使用して、ユーザーが当サイトや他のサイトに過去にアクセスした際の情報に基づき広告を配信します。ユーザーは広告設定でパーソナライズ広告を無効にできます。</p>
                <p class="font-bold text-gray-300">[2] 免責事項</p>
                <p class="mb-4">運営者は本サービス利用による損害について一切責任を負いません。投稿は90日後に自動削除されます。</p>
                <p class="font-bold text-gray-300">[3] コンテンツの品質</p>
                <p>ユーザーは、有用で健全なコミュニティ維持に努めるものとします。違反投稿は削除対象となります。</p>
            </div>
            <button onclick="document.getElementById('terms-modal').classList.add('hidden')" class="w-full btn-outline py-2">ACKNOWLEDGE</button>
        </div>
    </div>

    <div id="profile-modal" class="modal-overlay hidden">
        <div class="bg-black border border-gray-800 p-8 rounded shadow-2xl w-80 text-center">
            <input id="edit-name-input" type="text" class="w-full rounded p-3 mb-8" placeholder="Alias Name">
            <button id="save-profile-btn" class="w-full btn-primary py-3">SYNCHRONIZE</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, limit, onSnapshot, serverTimestamp, doc, getDoc, setDoc, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCA4NQzxcz2gh8uaw3LKrKl_NEnE_fMybs",
            authDomain: "lo-g-8a620.firebaseapp.com",
            projectId: "lo-g-8a620",
            storageBucket: "lo-g-8a620.firebasestorage.app",
            messagingSenderId: "780857099698",
            appId: "1:780857099698:web:b6cb359114da98ab3e50ab"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null, myProfile = null;

        // 認証
        const handleAuthError = (e) => alert("Auth Error: " + e.message);
        document.getElementById('google-login-btn').onclick = () => signInWithPopup(auth, new GoogleAuthProvider()).catch(handleAuthError);
        document.getElementById('email-login-btn').onclick = () => {
            const e = document.getElementById('auth-email').value, p = document.getElementById('auth-password').value;
            signInWithEmailAndPassword(auth, e, p).catch(handleAuthError);
        };
        document.getElementById('email-signup-btn').onclick = () => {
            const e = document.getElementById('auth-email').value, p = document.getElementById('auth-password').value;
            createUserWithEmailAndPassword(auth, e, p).catch(handleAuthError);
        };
        window.signOutApp = () => signOut(auth);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) { myProfile = userDoc.data(); initApp(); } 
                else { document.getElementById('login-screen').classList.add('hidden'); openProfileEditor(); }
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('app-screen').classList.add('hidden');
            }
        });

        function initApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-screen').classList.remove('hidden');
            document.getElementById('profile-modal').classList.add('hidden');
            document.getElementById('header-icon').src = myProfile.icon;
            document.getElementById('input-icon').src = myProfile.icon;
            document.getElementById('profile-big-icon').src = myProfile.icon;
            document.getElementById('profile-name').innerText = myProfile.name;
            loadTimeline();
        }

        document.getElementById('post-btn').onclick = async () => {
            const text = document.getElementById('post-text').value;
            if (!text.trim() || !myProfile) return;
            const exp = new Date(); exp.setDate(exp.getDate() + 90);
            await addDoc(collection(db, "logs"), {
                text, uid: currentUser.uid, authorName: myProfile.name, authorIcon: myProfile.icon,
                createdAt: serverTimestamp(), expireAt: exp
            });
            document.getElementById('post-text').value = "";
        };

        function loadTimeline() {
            const q = query(collection(db, "logs"), orderBy("createdAt", "desc"), limit(50));
            onSnapshot(q, (snap) => {
                const container = document.getElementById('timeline');
                container.innerHTML = "";
                snap.docs.forEach((doc, i) => {
                    // ★ 5件ごとに広告を挿入 (ログイン後画面)
                    if (i > 0 && i % 5 === 0) {
                        const ad = document.createElement('div'); ad.className = "p-4 bg-zinc-950 my-2 text-center border-y border-zinc-900";
                        ad.innerHTML = `<ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="-fb+5w+4e-db+86" data-ad-client="ca-pub-1539164935971262" data-ad-slot="YOUR_AD_SLOT_ID"></ins>`;
                        container.appendChild(ad); (adsbygoogle = window.adsbygoogle || []).push({});
                    }
                    container.appendChild(createPostEl(doc.data()));
                });
            });
        }

        function createPostEl(d) {
            const div = document.createElement('div');
            div.className = "p-6 flex gap-4 border-b border-zinc-900";
            div.innerHTML = `<img src="${d.authorIcon}" class="w-10 h-10 rounded bg-gray-900 border border-gray-800"><div class="w-full">
                <div class="flex justify-between items-center"><span class="font-bold text-xs text-gray-300">${d.authorName}</span><span class="text-[8px] text-gray-700">${d.createdAt ? d.createdAt.toDate().toLocaleString() : '...'}</span></div>
                <p class="mt-2 text-gray-400 text-sm whitespace-pre-wrap">${d.text}</p></div>`;
            return div;
        }

        window.openProfileEditor = () => {
            document.getElementById('profile-modal').classList.remove('hidden');
            if(myProfile) document.getElementById('edit-name-input').value = myProfile.name;
        };

        document.getElementById('save-profile-btn').onclick = async () => {
            const name = document.getElementById('edit-name-input').value;
            const icon = `https://api.dicebear.com/7.x/identicon/svg?seed=${auth.currentUser.uid}&backgroundColor=000000`;
            if(!name) return alert("Name required.");
            await setDoc(doc(db, "users", currentUser.uid), { name, icon, updatedAt: serverTimestamp() }, { merge: true });
            myProfile = { name, icon }; initApp();
        };

        window.switchTab = (t) => { ['home', 'profile'].forEach(x => document.getElementById(`tab-${x}`).classList.toggle('hidden', x !== t)); };
        window.openTerms = () => document.getElementById('terms-modal').classList.remove('hidden');
    </script>
</body>
</html>
