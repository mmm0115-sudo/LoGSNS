<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LoG Games | Arcade</title>

    <!-- OGP Meta Tags -->
    <meta property="og:title" content="LoG Games">
    <meta property="og:description" content="ã²ãŸã™ã‚‰ã‚¿ãƒƒãƒ—ã€é™ç•Œã®åå°„ç¥çµŒã€‚LoGã®ã‚¢ãƒ¼ã‚±ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ é›†ã€‚">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lo-g-8a620.web.app/games.html">
    <meta property="og:image" content="https://lo-g-8a620.web.app/assets/ogp.jpg">
    <meta name="twitter:card" content="summary_large_image">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+JP:wght@400;700;900&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #050505;
            color: #ffffff;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .hidden {
            display: none !important;
        }

        /* Glass Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 24px;
            transition: transform 0.2s, background 0.2s;
            cursor: pointer;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
        }

        .glass-card:active {
            transform: scale(0.98);
        }

        /* ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ç³» */
        .btn-giant {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 900;
            transition: transform 0.1s;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: none;
            outline: none;
        }

        .btn-giant:active {
            transform: scale(0.95);
        }

        /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .grad-1 {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        }

        .grad-2 {
            background: linear-gradient(135deg, #10b981, #0ea5e9);
        }

        .grad-3 {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
        }

        .grad-4 {
            background: linear-gradient(135deg, #d946ef, #db2777);
        }

        /* ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç”¨ */

        /* åå°„ç¥çµŒã‚²ãƒ¼ãƒ ç”¨ */
        .bg-wait {
            background-color: #ef4444;
            transition: background-color 0s;
        }

        .bg-ready {
            background-color: #10b981;
            transition: background-color 0s;
        }

        /* ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç”¨ã‚­ãƒ£ãƒ³ãƒã‚¹ */
        #g4-canvas {
            touch-action: none;
            cursor: crosshair;
        }
    </style>
</head>

<body class="flex flex-col min-h-screen">

    <!-- å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header
        class="p-4 md:p-6 flex items-center justify-between border-b border-white/10 bg-black/50 backdrop-blur sticky top-0 z-50 pointer-events-auto">
        <div class="flex items-center gap-4">
            <button onclick="goHome()" id="back-btn" class="text-gray-400 hover:text-white transition"><span
                    class="material-icons-round text-3xl">arrow_back</span></button>
            <h1 class="text-xl font-black tracking-tight">LoG Arcade</h1>
        </div>
        <span class="text-xs font-bold bg-white/10 px-3 py-1 rounded-full tracking-widest uppercase">Local Play</span>
    </header>

    <main class="flex-1 relative">

        <!-- ========================================== -->
        <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ -->
        <!-- ========================================== -->
        <div id="view-menu" class="max-w-4xl mx-auto p-6 pt-12 animate-[fadeIn_0.5s_ease-out]">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-black mb-2">Select Game</h2>
                <p class="text-gray-400">æš‡ã¤ã¶ã—ã¨ã€é™ç•Œã¸ã®æŒ‘æˆ¦ã€‚</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Game 1 -->
                <div class="glass-card flex flex-col" onclick="showGame('game1')">
                    <div class="w-16 h-16 rounded-2xl grad-1 flex items-center justify-center mb-6">
                        <span class="material-icons-round text-3xl text-white">touch_app</span>
                    </div>
                    <h3 class="text-2xl font-black mb-2">Tap Smash</h3>
                    <p class="text-gray-400 text-sm mb-6 flex-1">10ç§’é–“ã§ç”»é¢ã‚’ä½•å›ã‚¿ãƒƒãƒ—ã§ãã‚‹ã‹ã€‚æŒ‡ã®é™ç•Œã‚’è¶…ãˆã‚ã€‚</p>
                    <div class="mt-auto border-t border-white/10 pt-4 flex justify-between items-center text-sm">
                        <span class="text-gray-500">Record</span>
                        <span class="font-bold text-blue-400"><span id="record-g1">0</span> Taps</span>
                    </div>
                </div>

                <!-- Game 2 -->
                <div class="glass-card flex flex-col" onclick="showGame('game2')">
                    <div class="w-16 h-16 rounded-2xl grad-2 flex items-center justify-center mb-6">
                        <span class="material-icons-round text-3xl text-white">bolt</span>
                    </div>
                    <h3 class="text-2xl font-black mb-2">Reflex Test</h3>
                    <p class="text-gray-400 text-sm mb-6 flex-1">ç”»é¢ãŒèµ¤ã‹ã‚‰ç·‘ã«å¤‰ã‚ã£ãŸç¬é–“ã«ã‚¿ãƒƒãƒ—ã€‚åå°„ç¥çµŒã®ãƒ†ã‚¹ãƒˆã€‚</p>
                    <div class="mt-auto border-t border-white/10 pt-4 flex justify-between items-center text-sm">
                        <span class="text-gray-500">Fastest</span>
                        <span class="font-bold text-emerald-400"><span id="record-g2">--</span> ms</span>
                    </div>
                </div>

                <!-- Game 3 -->
                <div class="glass-card flex flex-col" onclick="showGame('game3')">
                    <div class="w-16 h-16 rounded-2xl grad-3 flex items-center justify-center mb-6">
                        <span class="material-icons-round text-3xl text-white">timer</span>
                    </div>
                    <h3 class="text-2xl font-black mb-2">Perfect 10</h3>
                    <p class="text-gray-400 text-sm mb-6 flex-1">è¦‹ãˆãªããªã‚‹ã‚¿ã‚¤ãƒãƒ¼ã‚’ã€è‡ªåˆ†ã®æ„Ÿè¦šã ã‘ã§ã€Œãƒ”ãƒƒã‚¿ãƒª10.00ç§’ã€ã§æ­¢ã‚ã‚ã€‚</p>
                    <div class="mt-auto border-t border-white/10 pt-4 flex justify-between items-center text-sm">
                        <span class="text-gray-500">Closest Diff</span>
                        <span class="font-bold text-orange-400">Â± <span id="record-g3">--</span> s</span>
                    </div>
                </div>

                <!-- â˜… NEW! Game 4: Neon Danmaku (å¼¾å¹•ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°) -->
                <div class="glass-card flex flex-col md:col-span-3 border-pink-500/30 hover:border-pink-500/50"
                    onclick="showGame('game4')">
                    <div class="flex items-start justify-between mb-4">
                        <div class="w-16 h-16 rounded-2xl grad-4 flex items-center justify-center">
                            <span class="material-icons-round text-3xl text-white">flare</span>
                        </div>
                        <span
                            class="bg-pink-500 text-white text-xs font-black px-3 py-1 rounded-full uppercase tracking-wider animate-pulse">Bullet
                            Hell</span>
                    </div>
                    <h3 class="text-3xl font-black mb-2 text-transparent bg-clip-text grad-4">Neon Danmaku</h3>
                    <p class="text-gray-400 text-sm md:text-base mb-6 flex-1">
                        å¹¾ä½•å­¦çš„ãªã€Œå¼¾å¹•ã€ã‚’é¿ã‘ã‚ã€‚å½“ãŸã‚Šåˆ¤å®šã¯ä¸­å¿ƒã®èµ¤ã„ç‚¹ï¼ˆã‚³ã‚¢ï¼‰ã®ã¿ã€‚<br>
                        æ•µå¼¾ã‚’ã‚®ãƒªã‚®ãƒªã§é¿ã‘ã‚‹ã€ŒGRAZEï¼ˆã‹ã™ã‚Šï¼‰ã€ã¨ã€ä¸Šéƒ¨ã§ã®ã‚¢ã‚¤ãƒ†ãƒ è‡ªå‹•å›åã‚’é§†ä½¿ã—ã¦ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’ç›®æŒ‡ã›ã€‚
                    </p>
                    <div class="mt-auto border-t border-white/10 pt-4 flex justify-between items-center text-sm">
                        <span class="text-gray-500">High Score</span>
                        <span class="font-bold text-pink-400"><span id="record-g4">0</span> Pts</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- Game 1: Tap Smash (é€£æ‰“) -->
        <!-- ========================================== -->
        <div id="view-game1" class="hidden absolute inset-0 flex flex-col items-center justify-center p-6">
            <div id="g1-setup" class="text-center">
                <h2 class="text-5xl font-black mb-4">Tap Smash</h2>
                <p class="text-gray-400 mb-12">10ç§’é–“ã€ã¨ã«ã‹ãé€£æ‰“ã—ã‚ï¼</p>
                <button onclick="g1_start()"
                    class="bg-white text-black px-12 py-4 rounded-full font-black text-2xl hover:scale-105 transition">START</button>
            </div>

            <div id="g1-play" class="hidden w-full max-w-sm text-center">
                <div class="flex justify-between items-end mb-12 px-4 border-b border-white/20 pb-4">
                    <div class="text-left">
                        <div class="text-xs text-gray-400 font-bold tracking-widest">TIME</div>
                        <div class="text-4xl font-black text-white font-mono" id="g1-time">10.0</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-400 font-bold tracking-widest">SCORE</div>
                        <div class="text-5xl font-black text-blue-500 font-mono" id="g1-score">0</div>
                    </div>
                </div>
                <button onclick="g1_tap()" class="btn-giant grad-1 text-white mx-auto">TAP!</button>
            </div>

            <div id="g1-result" class="hidden text-center">
                <h2 class="text-2xl font-bold text-gray-400 tracking-widest mb-2">TIME UP!</h2>
                <div class="text-8xl font-black text-white mb-8" id="g1-final-score">0</div>
                <p id="g1-new-record" class="hidden text-yellow-400 font-bold mb-8 animate-pulse">ğŸ‰ NEW RECORD! ğŸ‰</p>
                <div class="flex flex-col gap-3 mt-4">
                    <button onclick="g1_reset()"
                        class="bg-white/10 border border-white/20 px-8 py-3 rounded-full font-bold hover:bg-white/20 transition">ã‚‚ã†ä¸€åº¦</button>
                    <button onclick="shareGame('Tap Smash', g1_score + 'å›')"
                        class="bg-black border border-gray-700 text-white px-8 py-3 rounded-full font-bold hover:bg-gray-900 transition flex items-center justify-center gap-2"><svg
                            class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path
                                d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 22.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z">
                            </path>
                        </svg> Xã§ã‚·ã‚§ã‚¢</button>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- Game 2: Reflex Test (åå°„ç¥çµŒ) -->
        <!-- ========================================== -->
        <div id="view-game2" class="hidden absolute inset-0 flex flex-col items-center justify-center p-6">
            <div id="g2-setup" class="text-center z-10 relative">
                <h2 class="text-5xl font-black mb-4">Reflex Test</h2>
                <p class="text-gray-400 mb-12">ç”»é¢ãŒèµ¤ã‹ã‚‰ã€Œç·‘ã€ã«å¤‰ã‚ã£ãŸã‚‰ã‚¿ãƒƒãƒ—ï¼</p>
                <button onclick="g2_start()"
                    class="bg-white text-black px-12 py-4 rounded-full font-black text-2xl hover:scale-105 transition">START</button>
            </div>

            <div id="g2-play-area" onclick="g2_tap()"
                class="hidden absolute inset-0 flex flex-col items-center justify-center cursor-pointer select-none z-0">
                <div id="g2-message" class="text-4xl font-black text-white pointer-events-none drop-shadow-md">Wait for
                    Green...</div>
            </div>

            <div id="g2-result" class="hidden text-center z-10 relative">
                <h2 class="text-xl font-bold text-gray-400 tracking-widest mb-2" id="g2-result-title">YOUR TIME</h2>
                <div class="text-7xl font-black text-white mb-8" id="g2-final-time">0 ms</div>
                <p id="g2-new-record" class="hidden text-yellow-400 font-bold mb-8 animate-pulse">ğŸ‰ FASTEST TIME! ğŸ‰
                </p>
                <div class="flex flex-col gap-3 mt-4 z-20 relative">
                    <button onclick="g2_reset()"
                        class="bg-white/10 border border-white/20 px-8 py-3 rounded-full font-bold hover:bg-white/20 transition">ã‚‚ã†ä¸€åº¦</button>
                    <button onclick="shareGame('Reflex Test', document.getElementById('g2-final-time').innerText)"
                        class="bg-black border border-gray-700 text-white px-8 py-3 rounded-full font-bold hover:bg-gray-900 transition flex items-center justify-center gap-2"><svg
                            class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path
                                d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 22.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z">
                            </path>
                        </svg> Xã§ã‚·ã‚§ã‚¢</button>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- Game 3: Perfect 10 (ä½“å†…æ™‚è¨ˆ) -->
        <!-- ========================================== -->
        <div id="view-game3" class="hidden absolute inset-0 flex flex-col items-center justify-center p-6">
            <div id="g3-setup" class="text-center">
                <h2 class="text-5xl font-black mb-4 text-orange-500">Perfect 10</h2>
                <p class="text-gray-400 mb-12 max-w-sm mx-auto leading-relaxed">
                    ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã¨ã‚¿ã‚¤ãƒãƒ¼ãŒèµ°ã‚Šã€3ç§’ã§è¦‹ãˆãªããªã‚Šã¾ã™ã€‚è‡ªåˆ†ã®æ„Ÿè¦šã‚’é ¼ã‚Šã«ã€ã´ã£ãŸã‚Šã€Œ10.00ç§’ã€ã§ã‚¹ãƒˆãƒƒãƒ—ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
                <button onclick="g3_start()"
                    class="bg-white text-black px-12 py-4 rounded-full font-black text-2xl hover:scale-105 transition">START</button>
            </div>

            <div id="g3-play" class="hidden w-full text-center flex flex-col items-center justify-center h-full">
                <div class="text-8xl font-black text-white font-mono mb-16 tracking-tighter" id="g3-timer-display">0.00
                </div>
                <button onclick="g3_stop()" class="btn-giant grad-3 text-white border-4 border-white/20">STOP</button>
            </div>

            <div id="g3-result" class="hidden text-center">
                <h2 class="text-2xl font-bold text-gray-400 tracking-widest mb-2">RESULT</h2>
                <div class="text-7xl font-black text-white font-mono mb-2" id="g3-final-time">10.00</div>
                <div class="text-xl font-bold mb-8" id="g3-diff-display">èª¤å·®: 0.00s</div>

                <p id="g3-new-record" class="hidden text-yellow-400 font-bold mb-8 animate-pulse">ğŸ‰ CLOSEST RECORD! ğŸ‰
                </p>
                <div class="flex flex-col gap-3 mt-4">
                    <button onclick="g3_reset()"
                        class="bg-white/10 border border-white/20 px-8 py-3 rounded-full font-bold hover:bg-white/20 transition">ã‚‚ã†ä¸€åº¦</button>
                    <button onclick="shareGame('Perfect 10', document.getElementById('g3-diff-display').innerText)"
                        class="bg-black border border-gray-700 text-white px-8 py-3 rounded-full font-bold hover:bg-gray-900 transition flex items-center justify-center gap-2"><svg
                            class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path
                                d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 22.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z">
                            </path>
                        </svg> Xã§ã‚·ã‚§ã‚¢</button>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- â˜… NEW! Game 4: Neon Danmaku (å¼¾å¹•ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°) -->
        <!-- ========================================== -->
        <div id="view-game4"
            class="hidden absolute inset-0 flex flex-col items-center justify-center bg-[#050505] overflow-hidden">

            <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
            <div id="g4-setup"
                class="text-center z-20 absolute inset-0 flex flex-col items-center justify-center bg-black/80 backdrop-blur-sm">
                <h2 class="text-6xl font-black mb-2 text-transparent bg-clip-text grad-4">Neon Danmaku</h2>
                <p class="text-gray-400 mb-8 font-bold tracking-widest text-sm max-w-sm">
                    æŒ‡ã§ã‚¹ãƒ¯ã‚¤ãƒ—ã€ã¾ãŸã¯ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰(çŸ¢å°/WASD)ã§ç§»å‹•ã€‚Shiftã§ä½é€Ÿç§»å‹•ã€‚ç”»é¢ä¸Šéƒ¨ã«è¡Œãã¨ã‚¢ã‚¤ãƒ†ãƒ è‡ªå‹•å›åã€‚</p>
                <button onclick="g4_start()"
                    class="bg-white text-black px-12 py-4 rounded-full font-black text-2xl hover:scale-105 transition shadow-[0_0_20px_rgba(219,39,119,0.5)]">START</button>
            </div>

            <!-- ã‚²ãƒ¼ãƒ ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
            <canvas id="g4-canvas" class="w-full h-full block z-0"></canvas>

            <!-- ãƒ—ãƒ¬ã‚¤ä¸­UI (ã‚¹ã‚³ã‚¢ & ãƒ©ã‚¤ãƒ• & ã‚°ãƒ¬ã‚¤ã‚º) -->
            <div id="g4-ui"
                class="absolute top-[80px] left-6 right-6 flex justify-between items-start pointer-events-none hidden z-10">
                <div>
                    <div class="text-xs font-bold text-pink-400 tracking-widest">SCORE</div>
                    <div class="text-3xl font-black text-white drop-shadow-lg font-mono mb-2" id="g4-score-display">0
                    </div>
                    <div class="flex gap-1" id="g4-hp-display"></div>
                </div>
                <div class="text-right">
                    <div class="text-xs font-bold text-blue-400 tracking-widest">GRAZE</div>
                    <div class="text-2xl font-black text-white drop-shadow-lg font-mono" id="g4-graze-display">0</div>
                </div>
            </div>

            <!-- ãƒªã‚¶ãƒ«ãƒˆç”»é¢ -->
            <div id="g4-result"
                class="hidden text-center z-20 absolute inset-0 flex flex-col items-center justify-center bg-black/90 backdrop-blur-md">
                <h2 class="text-2xl font-bold text-pink-500 tracking-widest mb-2">GAME OVER</h2>
                <div class="text-8xl font-black text-white mb-2 font-mono" id="g4-final-score">0</div>
                <div class="text-gray-400 mb-8">Graze: <span id="g4-final-graze"
                        class="font-bold text-blue-400">0</span></div>
                <p id="g4-new-record" class="hidden text-yellow-400 font-bold mb-8 animate-pulse">ğŸ‰ NEW HIGH SCORE! ğŸ‰
                </p>
                <div class="flex flex-col gap-3 mt-4">
                    <button onclick="g4_reset()"
                        class="bg-white/10 border border-white/20 px-8 py-3 rounded-full font-bold hover:bg-white/20 transition">ã‚‚ã†ä¸€åº¦</button>
                    <button onclick="shareGame('Neon Danmaku', g4_score + 'pts')"
                        class="bg-black border border-gray-700 text-white px-8 py-3 rounded-full font-bold hover:bg-gray-900 transition flex items-center justify-center gap-2"><svg
                            class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path
                                d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 22.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z">
                            </path>
                        </svg> Xã§ã‚·ã‚§ã‚¢</button>
                </div>
            </div>

        </div>

    </main>

    <script type="module">
        import { shareToX } from './assets/js/core.js';

        window.shareGame = (title, score) => {
            const txt = `LoG Gamesã®ã€Œ${title}ã€ã§ ${score} ã‚’è¨˜éŒ²ã—ãŸï¼\né™ç•Œã«æŒ‘æˆ¦ã—ã‚ˆã†ã€‚ #LoG_Ecosystem #LoGGames`;
            shareToX(txt, 'https://lo-g-8a620.web.app/games.html');
        };

        // --- ç”»é¢é·ç§»ç®¡ç† ---
        let currentView = 'menu';

        function showGame(gameId) {
            document.getElementById('view-menu').classList.add('hidden');
            document.getElementById('view-game1').classList.add('hidden');
            document.getElementById('view-game2').classList.add('hidden');
            document.getElementById('view-game3').classList.add('hidden');
            document.getElementById('view-game4').classList.add('hidden');

            document.getElementById('view-' + gameId).classList.remove('hidden');
            currentView = gameId;

            document.getElementById('back-btn').onclick = goMenu;

            // ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç”»é¢ã®åˆæœŸåŒ–è¨­å®š
            if (gameId === 'game4') g4_resize();
        }

        function goMenu() {
            g1_reset();
            g2_reset();
            g3_reset();
            g4_forceEnd();

            document.getElementById('view-game1').classList.add('hidden');
            document.getElementById('view-game2').classList.add('hidden');
            document.getElementById('view-game3').classList.add('hidden');
            document.getElementById('view-game4').classList.add('hidden');
            document.getElementById('view-menu').classList.remove('hidden');
            currentView = 'menu';

            document.getElementById('back-btn').onclick = goHome;
            loadRecords();
        }

        function goHome() {
            window.location.href = 'index.html';
        }

        // --- è¨˜éŒ²ãƒ­ãƒ¼ãƒ‰ (Local) ---
        function loadRecords() {
            const r1 = localStorage.getItem('log_g1_high') || 0;
            const r2 = localStorage.getItem('log_g2_best');
            const r3 = localStorage.getItem('log_g3_best');
            const r4 = localStorage.getItem('log_g4_high') || 0;

            document.getElementById('record-g1').innerText = r1;
            document.getElementById('record-g2').innerText = r2 ? r2 : '--';
            document.getElementById('record-g3').innerText = r3 ? parseFloat(r3).toFixed(2) : '--';
            document.getElementById('record-g4').innerText = r4;
        }

        loadRecords();

        // ==========================================
        // Game 1: Tap Smash ãƒ­ã‚¸ãƒƒã‚¯
        // ==========================================
        let g1_score = 0; let g1_timeLeft = 10.0; let g1_timer = null; let g1_isPlaying = false;
        function g1_start() {
            g1_score = 0; g1_timeLeft = 10.0; g1_isPlaying = true;
            document.getElementById('g1-setup').classList.add('hidden'); document.getElementById('g1-result').classList.add('hidden'); document.getElementById('g1-new-record').classList.add('hidden'); document.getElementById('g1-play').classList.remove('hidden');
            document.getElementById('g1-score').innerText = g1_score; document.getElementById('g1-time').innerText = g1_timeLeft.toFixed(1);
            g1_timer = setInterval(() => {
                g1_timeLeft -= 0.1; document.getElementById('g1-time').innerText = Math.max(0, g1_timeLeft).toFixed(1);
                if (g1_timeLeft <= 0) g1_end();
            }, 100);
        }
        function g1_tap() {
            if (!g1_isPlaying) return; g1_score++; document.getElementById('g1-score').innerText = g1_score;
            const btn = document.querySelector('#g1-play .btn-giant'); btn.style.transform = 'scale(0.9)'; setTimeout(() => btn.style.transform = 'scale(1)', 50);
        }
        function g1_end() {
            clearInterval(g1_timer); g1_isPlaying = false; document.getElementById('g1-play').classList.add('hidden'); document.getElementById('g1-result').classList.remove('hidden'); document.getElementById('g1-final-score').innerText = g1_score;
            let high = parseInt(localStorage.getItem('log_g1_high') || 0);
            if (g1_score > high) { localStorage.setItem('log_g1_high', g1_score); document.getElementById('g1-new-record').classList.remove('hidden'); }
        }
        function g1_reset() { clearInterval(g1_timer); g1_isPlaying = false; document.getElementById('g1-play').classList.add('hidden'); document.getElementById('g1-result').classList.add('hidden'); document.getElementById('g1-setup').classList.remove('hidden'); }

        // ==========================================
        // Game 2: Reflex Test ãƒ­ã‚¸ãƒƒã‚¯
        // ==========================================
        let g2_state = 'init'; let g2_timeout = null; let g2_startTime = 0;
        function g2_start() {
            document.getElementById('g2-setup').classList.add('hidden'); document.getElementById('g2-result').classList.add('hidden'); document.getElementById('g2-new-record').classList.add('hidden');
            const area = document.getElementById('g2-play-area'); area.classList.remove('hidden'); area.className = "absolute inset-0 flex flex-col items-center justify-center cursor-pointer select-none z-0 bg-wait";
            document.getElementById('g2-message').innerText = "Wait for Green...";
            g2_state = 'waiting';
            g2_timeout = setTimeout(g2_go, Math.random() * 3000 + 2000);
        }
        function g2_go() {
            if (g2_state !== 'waiting') return; g2_state = 'ready';
            const area = document.getElementById('g2-play-area'); area.className = "absolute inset-0 flex flex-col items-center justify-center cursor-pointer select-none z-0 bg-ready";
            document.getElementById('g2-message').innerText = "TAP NOW!"; g2_startTime = performance.now();
        }
        function g2_tap() {
            if (g2_state === 'init' || g2_state === 'done') return;
            if (g2_state === 'waiting') { clearTimeout(g2_timeout); g2_end("TOO SOON!", "ãƒ•ãƒ©ã‚¤ãƒ³ã‚°ã§ã™"); }
            else if (g2_state === 'ready') {
                const reactionTime = Math.round(performance.now() - g2_startTime); g2_end(reactionTime + " ms", "TIME");
                let best = localStorage.getItem('log_g2_best');
                if (!best || reactionTime < parseInt(best)) { localStorage.setItem('log_g2_best', reactionTime); document.getElementById('g2-new-record').classList.remove('hidden'); }
            }
        }
        function g2_end(timeText, titleText) {
            g2_state = 'done'; document.getElementById('g2-play-area').classList.add('hidden'); document.getElementById('g2-result').classList.remove('hidden'); document.getElementById('g2-final-time').innerText = timeText; document.getElementById('g2-result-title').innerText = titleText;
        }
        function g2_reset() { clearTimeout(g2_timeout); g2_state = 'init'; document.getElementById('g2-play-area').classList.add('hidden'); document.getElementById('g2-result').classList.add('hidden'); document.getElementById('g2-setup').classList.remove('hidden'); }

        // ==========================================
        // Game 3: Perfect 10 ãƒ­ã‚¸ãƒƒã‚¯
        // ==========================================
        let g3_startTime = 0; let g3_timer = null; let g3_isPlaying = false;
        function g3_start() {
            g3_isPlaying = true; document.getElementById('g3-setup').classList.add('hidden'); document.getElementById('g3-result').classList.add('hidden'); document.getElementById('g3-new-record').classList.add('hidden'); document.getElementById('g3-play').classList.remove('hidden');
            const display = document.getElementById('g3-timer-display'); display.innerText = "0.00"; display.classList.remove('opacity-0');
            g3_startTime = performance.now();
            g3_timer = setInterval(() => {
                const elapsed = (performance.now() - g3_startTime) / 1000;
                if (elapsed > 3.0 && !display.classList.contains('opacity-0')) display.classList.add('transition-opacity', 'duration-500', 'opacity-0');
                if (elapsed <= 3.5) display.innerText = elapsed.toFixed(2);
            }, 10);
        }
        function g3_stop() {
            if (!g3_isPlaying) return; clearInterval(g3_timer); g3_isPlaying = false;
            const elapsed = (performance.now() - g3_startTime) / 1000; const diff = Math.abs(10.00 - elapsed);
            document.getElementById('g3-play').classList.add('hidden'); document.getElementById('g3-result').classList.remove('hidden'); document.getElementById('g3-final-time').innerText = elapsed.toFixed(3) + "s";
            const diffEl = document.getElementById('g3-diff-display'); diffEl.innerText = "èª¤å·®: Â±" + diff.toFixed(3) + "s";
            if (diff <= 0.1) diffEl.className = "text-xl font-bold mb-8 text-emerald-400"; else if (diff <= 0.5) diffEl.className = "text-xl font-bold mb-8 text-blue-400"; else diffEl.className = "text-xl font-bold mb-8 text-red-400";
            let best = localStorage.getItem('log_g3_best');
            if (!best || diff < parseFloat(best)) { localStorage.setItem('log_g3_best', diff.toFixed(3)); document.getElementById('g3-new-record').classList.remove('hidden'); }
        }
        function g3_reset() { clearInterval(g3_timer); g3_isPlaying = false; document.getElementById('g3-play').classList.add('hidden'); document.getElementById('g3-result').classList.add('hidden'); document.getElementById('g3-setup').classList.remove('hidden'); document.getElementById('g3-timer-display').classList.remove('opacity-0', 'transition-opacity', 'duration-500'); }

        // ==========================================
        // â˜… NEW! Game 4: Neon Danmaku ãƒ­ã‚¸ãƒƒã‚¯
        // ==========================================
        const g4_canvas = document.getElementById('g4-canvas');
        const g4_ctx = g4_canvas.getContext('2d');
        let g4_width, g4_height, g4_reqId;
        let g4_isPlaying = false;

        // ã‚²ãƒ¼ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (æ±æ–¹é¢¨ã« hitbox ã‚’æ¥µå°åŒ–)
        let g4_player = { x: 0, y: 0, size: 16, hitbox: 3, hp: 3, invincible: 0 };
        let g4_bullets = [];
        let g4_enemyBullets = [];
        let g4_enemies = [];
        let g4_items = [];
        let g4_particles = [];
        let g4_score = 0;
        let g4_graze = 0;
        let g4_frameCounter = 0;

        function g4_resize() {
            g4_width = window.innerWidth;
            g4_height = window.innerHeight;
            g4_canvas.width = g4_width;
            g4_canvas.height = g4_height;
            if (!g4_isPlaying) {
                g4_player.x = g4_width / 2;
                g4_player.y = g4_height - 150;
                g4_drawPlayer();
            }
        }
        window.addEventListener('resize', () => { if (currentView === 'game4') g4_resize(); });

        // --- æ“ä½œç³» (ç›¸å¯¾ç§»å‹•ãƒ»ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œå¯¾å¿œ) ---
        let g4_isDragging = false;
        let g4_dragStartX = 0; let g4_dragStartY = 0;
        let g4_playerStartX = 0; let g4_playerStartY = 0;

        // PCç”¨ (çµ¶å¯¾åº§æ¨™)
        g4_canvas.addEventListener('mousedown', (e) => { g4_isDragging = true; g4_player.x = e.clientX; g4_player.y = e.clientY; });
        g4_canvas.addEventListener('mousemove', (e) => { if (g4_isDragging) { g4_player.x = e.clientX; g4_player.y = e.clientY; } });
        g4_canvas.addEventListener('mouseup', () => { g4_isDragging = false; });

        // ã‚¹ãƒãƒ›ç”¨ (æŒ‡ã‚’éš ã•ãªã„ãŸã‚ã®ç›¸å¯¾ç§»å‹•)
        g4_canvas.addEventListener('touchstart', (e) => {
            g4_isDragging = true;
            g4_dragStartX = e.touches[0].clientX;
            g4_dragStartY = e.touches[0].clientY;
            g4_playerStartX = g4_player.x;
            g4_playerStartY = g4_player.y;
        }, { passive: false });
        g4_canvas.addEventListener('touchmove', (e) => {
            if (g4_isDragging && currentView === 'game4') {
                e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
                let dx = e.touches[0].clientX - g4_dragStartX;
                let dy = e.touches[0].clientY - g4_dragStartY;

                // å°‘ã—æ—©ã‚ã«å‹•ãã‚ˆã†ã«æ„Ÿåº¦èª¿æ•´
                g4_player.x = g4_playerStartX + (dx * 1.5);
                g4_player.y = g4_playerStartY + (dy * 1.5);

                // ç”»é¢å¤–ã«å‡ºãªã„ã‚ˆã†ã«
                g4_player.x = Math.max(10, Math.min(g4_width - 10, g4_player.x));
                g4_player.y = Math.max(10, Math.min(g4_height - 10, g4_player.y));
            }
        }, { passive: false });
        g4_canvas.addEventListener('touchend', () => { g4_isDragging = false; });

        // --- æ“ä½œç³» (ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å¯¾å¿œ) ---
        let g4_keys = { up: false, down: false, left: false, right: false, shift: false };
        window.addEventListener('keydown', (e) => {
            if (currentView === 'game4') {
                if (e.key === 'ArrowUp' || e.key.toLowerCase() === 'w') g4_keys.up = true;
                if (e.key === 'ArrowDown' || e.key.toLowerCase() === 's') g4_keys.down = true;
                if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') g4_keys.left = true;
                if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'd') g4_keys.right = true;
                if (e.key === 'Shift') g4_keys.shift = true;
            }
        });
        window.addEventListener('keyup', (e) => {
            if (currentView === 'game4') {
                if (e.key === 'ArrowUp' || e.key.toLowerCase() === 'w') g4_keys.up = false;
                if (e.key === 'ArrowDown' || e.key.toLowerCase() === 's') g4_keys.down = false;
                if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') g4_keys.left = false;
                if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'd') g4_keys.right = false;
                if (e.key === 'Shift') g4_keys.shift = false;
            }
        });

        function g4_start() {
            g4_resize();
            g4_player = { x: g4_width / 2, y: g4_height - 150, size: 16, hitbox: 3, hp: 3, invincible: 0 };
            g4_bullets = []; g4_enemyBullets = []; g4_enemies = []; g4_items = []; g4_particles = [];
            g4_score = 0; g4_graze = 0; g4_frameCounter = 0;
            g4_isPlaying = true;

            g4_updateUI();
            document.getElementById('g4-setup').classList.add('hidden');
            document.getElementById('g4-result').classList.add('hidden');
            document.getElementById('g4-new-record').classList.add('hidden');
            document.getElementById('g4-ui').classList.remove('hidden');

            g4_loop();
        }

        function g4_updateUI() {
            document.getElementById('g4-score-display').innerText = g4_score;
            document.getElementById('g4-graze-display').innerText = g4_graze;
            let hpHTML = '';
            for (let i = 0; i < g4_player.hp; i++) {
                hpHTML += '<span class="material-icons-round text-pink-500 text-xl drop-shadow-md">favorite</span>';
            }
            document.getElementById('g4-hp-display').innerHTML = hpHTML;
        }

        function g4_spawnEnemy() {
            let r = Math.random();
            let type = 'normal'; // è‡ªæ©Ÿç‹™ã„
            let hp = 3;
            let color = '#0ea5e9';
            let speed = Math.random() * 1.5 + 1;

            if (r > 0.85) { type = 'circle'; hp = 10; color = '#f59e0b'; speed = 0.5; } // å…¨æ–¹ä½ä¸­ãƒœã‚¹
            else if (r > 0.7) { type = 'spiral'; hp = 8; color = '#d946ef'; speed = 1.0; } // èºæ—‹ä¸­ãƒœã‚¹

            g4_enemies.push({
                x: Math.random() * (g4_width - 40) + 20,
                y: -30,
                vx: 0,
                vy: speed,
                size: type === 'normal' ? 15 : 25,
                color: color,
                hp: hp + Math.floor(g4_score / 5000), // æ™‚é–“çµŒéã§HPå¢—åŠ 
                type: type,
                tick: 0
            });
        }

        function g4_loop() {
            if (!g4_isPlaying) return;
            g4_reqId = requestAnimationFrame(g4_loop);
            g4_frameCounter++;

            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ç§»å‹•å‡¦ç† (Shiftã§ä½é€Ÿç§»å‹•)
            let speed = g4_keys.shift ? 2.5 : 6;
            if (g4_keys.up) g4_player.y -= speed;
            if (g4_keys.down) g4_player.y += speed;
            if (g4_keys.left) g4_player.x -= speed;
            if (g4_keys.right) g4_player.x += speed;

            // ç”»é¢å¤–ã«å‡ºãªã„ã‚ˆã†ã«ã‚¯ãƒ©ãƒ³ãƒ—
            g4_player.x = Math.max(10, Math.min(g4_width - 10, g4_player.x));
            g4_player.y = Math.max(10, Math.min(g4_height - 10, g4_player.y));

            // èƒŒæ™¯ã‚¯ãƒªã‚¢ (å°‘ã—æš—ã‚ã«)
            g4_ctx.fillStyle = 'rgba(5, 5, 5, 0.4)';
            g4_ctx.fillRect(0, 0, g4_width, g4_height);

            // --- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ ---
            if (g4_player.invincible > 0) g4_player.invincible--;

            // --- å¼¾ç™ºå°„ (è‡ªæ©Ÿ) ---
            if (g4_frameCounter % 6 === 0) {
                g4_bullets.push({ x: g4_player.x - 10, y: g4_player.y - 10, speed: -25, color: '#fbcfe8' });
                g4_bullets.push({ x: g4_player.x + 10, y: g4_player.y - 10, speed: -25, color: '#fbcfe8' });
                if (g4_score > 3000) { // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—
                    g4_bullets.push({ x: g4_player.x - 20, y: g4_player.y - 5, speed: -22, color: '#f472b6', vx: -1 });
                    g4_bullets.push({ x: g4_player.x + 20, y: g4_player.y - 5, speed: -22, color: '#f472b6', vx: 1 });
                }
            }

            // --- æ•µã‚¹ãƒãƒ¼ãƒ³ ---
            let spawnInterval = Math.max(30, 80 - Math.floor(g4_score / 200));
            if (g4_frameCounter % spawnInterval === 0) g4_spawnEnemy();

            // --- è‡ªæ©Ÿå¼¾ã®æ›´æ–° ---
            for (let i = g4_bullets.length - 1; i >= 0; i--) {
                let b = g4_bullets[i];
                b.y += b.speed;
                if (b.vx) b.x += b.vx;

                g4_ctx.fillStyle = b.color;
                g4_ctx.shadowBlur = 10; g4_ctx.shadowColor = b.color;
                g4_ctx.fillRect(b.x - 2, b.y - 8, 4, 16);
                g4_ctx.shadowBlur = 0;

                if (b.y < -20) g4_bullets.splice(i, 1);
            }

            // --- æ•µã®æ›´æ–°ãƒ»å¼¾å¹•ç™ºå°„ ---
            for (let i = g4_enemies.length - 1; i >= 0; i--) {
                let e = g4_enemies[i];
                e.x += e.vx; e.y += e.vy; e.tick++;

                // ãƒœã‚¹ã¯é€”ä¸­ã§æ­¢ã¾ã‚‹
                if ((e.type === 'circle' || e.type === 'spiral') && e.y > g4_height / 4) {
                    e.vy = 0;
                    e.x += Math.sin(e.tick * 0.05) * 1.5; // ãµã‚ãµã‚å‹•ã
                }

                // å¼¾å¹•ãƒ‘ã‚¿ãƒ¼ãƒ³
                if (e.type === 'normal' && e.tick % 60 === 0 && e.y > 0 && e.y < g4_height / 2) {
                    // è‡ªæ©Ÿç‹™ã„
                    let angle = Math.atan2(g4_player.y - e.y, g4_player.x - e.x);
                    g4_enemyBullets.push({ x: e.x, y: e.y, vx: Math.cos(angle) * 4, vy: Math.sin(angle) * 4, color: '#ef4444', size: 5 });
                }
                else if (e.type === 'circle' && e.tick % 50 === 0) {
                    // å…¨æ–¹ä½
                    for (let a = 0; a < Math.PI * 2; a += Math.PI / 6) {
                        g4_enemyBullets.push({ x: e.x, y: e.y, vx: Math.cos(a) * 3, vy: Math.sin(a) * 3, color: '#f59e0b', size: 6 });
                    }
                }
                else if (e.type === 'spiral' && e.tick % 6 === 0) {
                    // èºæ—‹
                    let a = e.tick * 0.15;
                    g4_enemyBullets.push({ x: e.x, y: e.y, vx: Math.cos(a) * 4, vy: Math.sin(a) * 4, color: '#d946ef', size: 5 });
                    g4_enemyBullets.push({ x: e.x, y: e.y, vx: Math.cos(a + Math.PI) * 4, vy: Math.sin(a + Math.PI) * 4, color: '#3b82f6', size: 5 });
                }

                // æç”»
                g4_ctx.fillStyle = e.color;
                g4_ctx.shadowBlur = 15; g4_ctx.shadowColor = e.color;
                g4_ctx.beginPath();
                g4_ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
                g4_ctx.fill();
                g4_ctx.shadowBlur = 0;

                // è‡ªæ©Ÿå¼¾ã¨ã®å½“ãŸã‚Šåˆ¤å®š
                for (let j = g4_bullets.length - 1; j >= 0; j--) {
                    let b = g4_bullets[j];
                    if (Math.hypot(b.x - e.x, b.y - e.y) < e.size + 4) {
                        e.hp--; g4_bullets.splice(j, 1);
                        g4_createParticles(b.x, b.y, '#ffffff', 2);
                        if (e.hp <= 0) {
                            g4_createParticles(e.x, e.y, e.color, 15);

                            // ã‚¢ã‚¤ãƒ†ãƒ ãƒ‰ãƒ­ãƒƒãƒ—
                            let dropCount = e.type === 'normal' ? 1 : 5;
                            for (let k = 0; k < dropCount; k++) {
                                g4_items.push({ x: e.x + (Math.random() - 0.5) * 20, y: e.y + (Math.random() - 0.5) * 20, vy: -3 + Math.random() * 2 });
                            }

                            g4_score += (e.size > 20 ? 100 : 20);
                            g4_enemies.splice(i, 1);
                            g4_updateUI();
                            break;
                        }
                    }
                }

                // ä½“å½“ãŸã‚Šåˆ¤å®š
                if (g4_enemies[i] && g4_player.invincible <= 0) {
                    if (Math.hypot(g4_player.x - e.x, g4_player.y - e.y) < g4_player.hitbox + e.size) {
                        g4_hitPlayer();
                        if (!g4_isPlaying) return;
                    }
                }

                // ç”»é¢å¤–å‰Šé™¤
                if (e.y > g4_height + 50 && g4_enemies[i]) g4_enemies.splice(i, 1);
            }

            // --- æ•µå¼¾ã®æ›´æ–°ãƒ»åˆ¤å®š ---
            for (let i = g4_enemyBullets.length - 1; i >= 0; i--) {
                let b = g4_enemyBullets[i];
                b.x += b.vx; b.y += b.vy;

                g4_ctx.fillStyle = '#ffffff';
                g4_ctx.beginPath(); g4_ctx.arc(b.x, b.y, b.size, 0, Math.PI * 2); g4_ctx.fill();
                g4_ctx.fillStyle = b.color;
                g4_ctx.beginPath(); g4_ctx.arc(b.x, b.y, b.size - 2, 0, Math.PI * 2); g4_ctx.fill();

                let dist = Math.hypot(g4_player.x - b.x, g4_player.y - b.y);

                // è¢«å¼¾ (ã‚³ã‚¢åˆ¤å®š)
                if (dist < g4_player.hitbox + b.size - 1 && g4_player.invincible <= 0) {
                    g4_enemyBullets.splice(i, 1);
                    g4_hitPlayer();
                    if (!g4_isPlaying) return;
                }
                // ã‚°ãƒ¬ã‚¤ã‚º (ã‹ã™ã‚Šåˆ¤å®š)
                else if (dist < g4_player.size + b.size + 15 && !b.grazed && g4_player.invincible <= 0) {
                    b.grazed = true;
                    g4_graze++;
                    g4_score += 15;
                    g4_updateUI();
                    g4_createParticles(g4_player.x, g4_player.y, '#ffffff', 1); // ç«èŠ±
                }

                // ç”»é¢å¤–å‰Šé™¤
                if (b.y > g4_height + 20 || b.x < -20 || b.x > g4_width + 20) g4_enemyBullets.splice(i, 1);
            }

            // --- ã‚¢ã‚¤ãƒ†ãƒ ã®æ›´æ–° ---
            let autoCollect = (g4_player.y < g4_height * 0.3); // ç”»é¢ä¸Šéƒ¨ã§è‡ªå‹•å›å
            for (let i = g4_items.length - 1; i >= 0; i--) {
                let item = g4_items[i];

                if (autoCollect) {
                    let angle = Math.atan2(g4_player.y - item.y, g4_player.x - item.x);
                    item.x += Math.cos(angle) * 15;
                    item.y += Math.sin(angle) * 15;
                } else {
                    item.vy += 0.1; // é‡åŠ›
                    item.y += item.vy;
                }

                g4_ctx.fillStyle = '#60a5fa'; // ç‚¹ç¬¦ã‚«ãƒ©ãƒ¼
                g4_ctx.fillRect(item.x - 4, item.y - 4, 8, 8);

                // å–å¾—åˆ¤å®š
                if (Math.hypot(g4_player.x - item.x, g4_player.y - item.y) < g4_player.size + 10) {
                    g4_score += 500;
                    g4_items.splice(i, 1);
                    g4_updateUI();
                } else if (item.y > g4_height + 20) {
                    g4_items.splice(i, 1);
                }
            }

            // --- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« ---
            for (let i = g4_particles.length - 1; i >= 0; i--) {
                let p = g4_particles[i];
                p.x += p.vx; p.y += p.vy; p.life -= 0.05;
                g4_ctx.fillStyle = p.color; g4_ctx.globalAlpha = Math.max(0, p.life);
                g4_ctx.beginPath(); g4_ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); g4_ctx.fill();
                g4_ctx.globalAlpha = 1.0;
                if (p.life <= 0) g4_particles.splice(i, 1);
            }

            // --- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æç”» ---
            g4_drawPlayer();
        }

        function g4_hitPlayer() {
            g4_player.hp--;
            g4_player.invincible = 120; // 2ç§’ç„¡æ•µ
            g4_updateUI();
            g4_createParticles(g4_player.x, g4_player.y, '#db2777', 30);

            // ç”»é¢ãƒ•ãƒ©ãƒƒã‚·ãƒ¥
            g4_ctx.fillStyle = 'rgba(239, 68, 68, 0.5)';
            g4_ctx.fillRect(0, 0, g4_width, g4_height);

            if (g4_player.hp <= 0) g4_gameOver();
        }

        function g4_drawPlayer() {
            // ç‚¹æ»… (ç„¡æ•µæ™‚é–“ä¸­)
            if (g4_player.invincible > 0 && Math.floor(g4_player.invincible / 5) % 2 === 0) return;

            // æ©Ÿä½“
            g4_ctx.fillStyle = '#ffffff';
            g4_ctx.shadowBlur = 15; g4_ctx.shadowColor = '#db2777';
            g4_ctx.beginPath();
            g4_ctx.moveTo(g4_player.x, g4_player.y - g4_player.size);
            g4_ctx.lineTo(g4_player.x - g4_player.size, g4_player.y + g4_player.size);
            g4_ctx.lineTo(g4_player.x + g4_player.size, g4_player.y + g4_player.size);
            g4_ctx.closePath();
            g4_ctx.fill();
            g4_ctx.shadowBlur = 0;

            // ã‚³ã‚¢ (æ±æ–¹é¢¨ã®å½“ãŸã‚Šåˆ¤å®šå¯è¦–åŒ–)
            g4_ctx.fillStyle = '#ef4444';
            g4_ctx.beginPath();
            g4_ctx.arc(g4_player.x, g4_player.y, g4_player.hitbox, 0, Math.PI * 2);
            g4_ctx.fill();
        }

        function g4_createParticles(x, y, color, count) {
            for (let i = 0; i < count; i++) {
                g4_particles.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 8, vy: (Math.random() - 0.5) * 8,
                    life: 1.0, size: Math.random() * 3 + 1, color: color
                });
            }
        }

        function g4_gameOver() {
            g4_isPlaying = false;
            cancelAnimationFrame(g4_reqId);

            g4_createParticles(g4_player.x, g4_player.y, '#ffffff', 50);
            g4_createParticles(g4_player.x, g4_player.y, '#db2777', 30);

            setTimeout(() => {
                document.getElementById('g4-ui').classList.add('hidden');
                document.getElementById('g4-result').classList.remove('hidden');
                document.getElementById('g4-final-score').innerText = g4_score;
                document.getElementById('g4-final-graze').innerText = g4_graze;

                let high = parseInt(localStorage.getItem('log_g4_high') || 0);
                if (g4_score > high) {
                    localStorage.setItem('log_g4_high', g4_score);
                    document.getElementById('g4-new-record').classList.remove('hidden');

                }
            }, 500);
        }

        function g4_reset() {
            document.getElementById('g4-result').classList.add('hidden');
            document.getElementById('g4-setup').classList.remove('hidden');
            g4_ctx.clearRect(0, 0, g4_width, g4_height);
            g4_drawPlayer();
        }

        function g4_forceEnd() {
            g4_isPlaying = false;
            cancelAnimationFrame(g4_reqId);
        }
    </script>
</body>

</html>