<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LoG v1.3</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#ffffff">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1539164935971262" crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root { 
            --bg: #ffffff; --text: #0f1419; --border: #eff3f4; --card: #ffffff; 
            --subtext: #536471; --accent: #1d9bf0; --danger: #f4212e;
            --nav-bg: rgba(255,255,255,0.95);
        }
        .dark { 
            --bg: #000000; --text: #e7e9ea; --border: #2f3336; --card: #000000; 
            --subtext: #71767b; --accent: #1d9bf0; --nav-bg: rgba(0,0,0,0.95);
        }
        body { background-color: var(--bg); color: var(--text); font-family: 'Inter', 'Noto Sans JP', sans-serif; overflow-x: hidden; -webkit-tap-highlight-color: transparent; transition: background 0.3s, color 0.3s; }
        .hidden { display: none !important; }

        .btn-primary { background: var(--text); color: var(--bg); border-radius: 99px; padding: 6px 16px; font-weight: 700; font-size: 0.85rem; transition: 0.2s; }
        .btn-ghost { color: var(--subtext); padding: 8px; border-radius: 50%; }
        
        .nav-item { color: var(--subtext); padding: 12px; position: relative; transition: 0.2s; }
        .nav-active { color: var(--text); transform: scale(1.1); }
        .nav-badge { position: absolute; top: 8px; right: 8px; width: 8px; height: 8px; background: var(--danger); border-radius: 50%; display: none; }

        /* ãƒœãƒˆãƒ«ãƒ¡ãƒ¼ãƒ«æ¼”å‡º */
        .bottle-anim { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
        
        /* ç§°å·ãƒãƒƒã‚¸ */
        .title-badge { background: linear-gradient(45deg, #FFD700, #FFA500); color: #fff; padding: 2px 6px; border-radius: 4px; font-size: 0.6rem; font-weight: 900; margin-left: 4px; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }

        .modal-overlay { background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); }
    </style>
</head>
<body>

    <!-- Login -->
    <div id="login-screen" class="min-h-screen flex flex-col items-center justify-center p-8 bg-white dark:bg-black transition-colors">
        <h1 class="text-7xl font-black tracking-tighter mb-4 text-black dark:text-white">LoG</h1>
        <div class="inline-block bg-black dark:bg-white text-white dark:text-black px-4 py-1 rounded-full text-xs font-bold tracking-[0.3em] mb-12">v1.3 DRIFT</div>
        <div class="w-full max-w-sm space-y-4">
            <button id="google-login-btn" class="w-full border border-gray-300 dark:border-gray-700 py-3 rounded-full font-bold flex justify-center items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-900 transition">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5 h-5"> Google
            </button>
            <div id="email-form" class="space-y-3 pt-4 border-t border-gray-100 dark:border-gray-800">
                <input id="auth-email" type="email" placeholder="Email" class="w-full bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-lg p-3 outline-none">
                <input id="auth-password" type="password" placeholder="Password" class="w-full bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-lg p-3 outline-none">
                <div class="flex gap-2">
                    <button onclick="emailAuth('login')" class="flex-1 bg-black dark:bg-white text-white dark:text-black py-3 rounded-full font-bold">Login</button>
                    <button onclick="emailAuth('signup')" class="flex-1 border border-gray-300 dark:border-gray-700 py-3 rounded-full font-bold">Sign Up</button>
                </div>
            </div>
        </div>
    </div>

    <!-- App -->
    <div id="app-screen" class="hidden max-w-xl mx-auto min-h-screen bg-[var(--bg)] shadow-2xl relative pb-20 border-x border-[var(--border)]">
        
        <!-- Header (ç‚ã‚¢ã‚¤ã‚³ãƒ³å‰Šé™¤æ¸ˆã¿) -->
        <header class="sticky top-0 bg-[var(--nav-bg)] backdrop-blur-md z-40 border-b border-[var(--border)] px-4 py-3 flex justify-between items-center" onclick="window.scrollTo({top:0, behavior:'smooth'})">
            <img id="header-icon" src="" class="w-8 h-8 rounded-full object-cover border border-[var(--border)]" onclick="switchTab('profile')">
            <div class="text-xl font-black tracking-tight">LoG</div>
            <div class="w-8"></div> <!-- ãƒãƒ©ãƒ³ã‚¹ç”¨ç©ºç™½ -->
        </header>

        <!-- A. HOME -->
        <div id="tab-home" class="pb-24">
            <div class="p-4 border-b border-[var(--border)]">
                <div class="flex gap-3">
                    <img id="input-icon" src="" class="w-10 h-10 rounded-full bg-gray-200 object-cover">
                    <div class="flex-1">
                        <textarea id="post-text" rows="2" placeholder="ã„ã¾ã©ã†ã—ã¦ã‚‹ï¼Ÿ" class="w-full text-lg resize-none bg-transparent focus:outline-none placeholder-[var(--subtext)]"></textarea>
                        <div class="flex justify-end pt-2 border-t border-[var(--border)]">
                            <button id="post-btn" class="btn-primary">ãƒã‚¹ãƒˆ</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="timeline"></div>
        </div>

        <!-- B. BOTTLE (New! æ¼‚æµãƒ­ã‚°) -->
        <div id="tab-bottle" class="hidden text-center p-6 bg-[var(--bg)] min-h-[80vh] flex flex-col justify-center items-center">
            <span class="material-icons-round text-6xl text-blue-400 bottle-anim mb-4">sailing</span>
            <h2 class="text-2xl font-black mb-2">æ¼‚æµãƒ­ã‚°</h2>
            <p class="text-sm text-[var(--subtext)] mb-8">
                ã“ã“ã§ã¯ã€æŠ•ç¨¿ã¯èª°ã‹ä¸€äººã®å…ƒã«ã ã‘æµã‚Œç€ãã¾ã™ã€‚<br>
                è¦‹çŸ¥ã‚‰ã¬èª°ã‹ã®è¨€è‘‰ã‚’æ‹¾ã£ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ
            </p>

            <div class="space-y-4 w-full max-w-xs">
                <button onclick="pickupBottle()" class="w-full py-4 bg-gradient-to-r from-blue-500 to-cyan-400 text-white font-bold rounded-2xl shadow-lg hover:scale-105 transition transform">
                    <span class="material-icons-round align-middle mr-2">waves</span> ãƒ­ã‚°ã‚’æ‹¾ã†
                </button>
                
                <button onclick="openBottleModal()" class="w-full py-4 border-2 border-[var(--border)] font-bold rounded-2xl hover:bg-[var(--border)] transition">
                    <span class="material-icons-round align-middle mr-2">edit</span> ãƒ­ã‚°ã‚’æµã™
                </button>
            </div>

            <!-- æ‹¾ã£ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="bottle-result" class="hidden mt-8 p-6 bg-[var(--card)] border border-[var(--border)] rounded-2xl shadow-sm text-left w-full relative">
                <span class="absolute -top-3 left-4 bg-[var(--bg)] px-2 text-xs font-bold text-blue-500">æ¼‚ç€ç‰©</span>
                <p id="bottle-text" class="text-lg font-medium mb-4"></p>
                <div class="flex justify-between items-center text-xs text-[var(--subtext)]">
                    <span id="bottle-author">åç„¡ã—ã®æ¼‚æµè€…</span>
                    <span id="bottle-date"></span>
                </div>
            </div>
        </div>

        <!-- C. NOTIF -->
        <div id="tab-notif" class="hidden">
            <div class="p-3 border-b border-[var(--border)] font-bold text-lg px-4">é€šçŸ¥</div>
            <div id="notif-list" class="divide-y divide-[var(--border)]"></div>
        </div>

        <!-- D. PROFILE -->
        <div id="tab-profile" class="hidden">
            <div class="px-4 py-6">
                <div class="flex justify-between items-start mb-4">
                    <img id="profile-big-icon" src="" class="w-20 h-20 rounded-full border-4 border-[var(--bg)] bg-[var(--bg)] object-cover shadow-sm">
                    <button onclick="openSettings()" class="btn-primary bg-transparent text-[var(--text)] border border-[var(--border)]">è¨­å®š</button>
                </div>
                <div class="mt-3">
                    <h2 class="text-2xl font-black leading-tight flex items-center gap-2">
                        <span id="profile-name"></span>
                        <span id="profile-title" class="title-badge hidden"></span>
                    </h2>
                    <p id="profile-uid" class="text-sm text-[var(--subtext)] font-mono">@user</p>
                    
                    <div class="flex items-center gap-4 mt-4 p-3 bg-[var(--border)]/30 rounded-xl">
                        <div class="flex-1 text-center border-r border-[var(--border)]">
                            <div class="text-xs text-[var(--subtext)]">XP</div>
                            <div class="font-black text-lg" id="profile-xp">0</div>
                        </div>
                        <div onclick="spinGacha()" class="flex-1 text-center cursor-pointer active:scale-95 transition">
                            <div class="text-xs text-orange-500 font-bold">ç§°å·ã‚¬ãƒãƒ£</div>
                            <div class="font-black text-lg">50 XP</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex border-b border-[var(--border)] mt-2">
                <div class="flex-1 text-center py-3 font-bold border-b-2 border-[var(--text)]">ãƒã‚¹ãƒˆ</div>
                <div class="flex-1 text-center py-3 font-bold text-[var(--subtext)]">ã„ã„ã­</div>
            </div>
            <div id="my-timeline" class="divide-y divide-[var(--border)]"></div>
        </div>

        <!-- Navigation -->
        <nav class="fixed bottom-0 w-full max-w-xl bg-[var(--nav-bg)] border-t border-[var(--border)] flex justify-around py-3 z-50 backdrop-blur pb-6">
            <button onclick="switchTab('home')" class="nav-item nav-active" data-target="home"><span class="material-icons-round text-3xl">home</span></button>
            <button onclick="switchTab('bottle')" class="nav-item" data-target="bottle"><span class="material-icons-round text-3xl">sailing</span></button>
            <button onclick="switchTab('notif')" class="nav-item" data-target="notif">
                <span class="material-icons-round text-3xl">notifications</span>
                <div id="nav-badge" class="nav-badge"></div>
            </button>
            <button onclick="switchTab('profile')" class="nav-item" data-target="profile"><span class="material-icons-round text-3xl">person</span></button>
        </nav>
    </div>

    <!-- Bottle Modal -->
    <div id="bottle-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="bg-[var(--card)] p-6 rounded-2xl w-80 shadow-2xl border border-[var(--border)] text-center">
            <h2 class="text-lg font-bold mb-2">æ‰‹ç´™ã‚’æµã™</h2>
            <p class="text-xs text-[var(--subtext)] mb-4">èª°ã«å±Šãã‹ã¯é‹æ¬¡ç¬¬ã§ã™ã€‚</p>
            <textarea id="bottle-input" rows="4" class="w-full bg-[var(--border)]/30 rounded-xl p-3 mb-4 text-sm outline-none resize-none" placeholder="ã“ã“ã«ãªã«ã‹æ›¸ã„ã¦..."></textarea>
            <div class="flex gap-2">
                <button onclick="document.getElementById('bottle-modal').classList.add('hidden')" class="flex-1 py-3 text-sm font-bold text-[var(--subtext)]">ã‚„ã‚ã‚‹</button>
                <button onclick="sendBottle()" class="flex-1 btn-primary py-3">æµ·ã«æµã™</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="profile-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="bg-[var(--card)] p-6 rounded-2xl w-80 shadow-2xl border border-[var(--border)]">
            <h2 class="text-xl font-bold mb-4">åˆæœŸè¨­å®š</h2>
            <input id="edit-name-input" type="text" class="w-full bg-[var(--border)]/30 rounded p-3 mb-4 font-bold outline-none text-[var(--text)]" placeholder="è¡¨ç¤ºå">
            <button onclick="saveProfile()" class="w-full btn-primary py-3">é–‹å§‹</button>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="bg-[var(--card)] p-6 rounded-2xl w-80 shadow-2xl border border-[var(--border)]">
            <button onclick="toggleDarkMode()" class="w-full flex justify-between items-center p-3 font-bold mb-2">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ <span class="material-icons-round">dark_mode</span></button>
            <button onclick="signOutApp()" class="w-full text-left p-3 text-[var(--danger)] font-bold">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            <button onclick="document.getElementById('settings-modal').classList.add('hidden')" class="mt-4 w-full py-2 text-sm">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, limit, onSnapshot, serverTimestamp, doc, getDoc, setDoc, updateDoc, arrayUnion, arrayRemove, deleteDoc, increment, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyCA4NQzxcz2gh8uaw3LKrKl_NEnE_fMybs", authDomain: "lo-g-8a620.firebaseapp.com", projectId: "lo-g-8a620", storageBucket: "lo-g-8a620.firebasestorage.app", messagingSenderId: "780857099698", appId: "1:780857099698:web:b6cb359114da98ab3e50ab" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser=null, myProfile=null;

        // ã‚¬ãƒãƒ£ã®ç§°å·ãƒªã‚¹ãƒˆ
        const TITLES = ["è¦‹ç¿’ã„", "ä½äºº", "è©©äºº", "å“²å­¦", "è™šç„¡", "çŒ«", "ç¥", "å¯Œè±ª", "ãƒ‹ãƒ¼ãƒˆ", "å°†è»", "ä¼èª¬", "æ­©è¡Œè€…", "ç©ºæ°—", "å‹‡è€…"];

        // Auth
        const authErr = (e) => alert(e.message);
        document.getElementById('google-login-btn').onclick = () => signInWithPopup(auth, new GoogleAuthProvider()).catch(authErr);
        window.emailAuth = (t) => {
            const e=document.getElementById('auth-email').value, p=document.getElementById('auth-password').value;
            if(t==='login') signInWithEmailAndPassword(auth,e,p).catch(authErr);
            else createUserWithEmailAndPassword(auth,e,p).catch(authErr);
        }

        onAuthStateChanged(auth, async (u) => {
            if(u){
                currentUser = u;
                const d = await getDoc(doc(db,"users",u.uid));
                if(d.exists()){ myProfile = d.data(); initApp(); } 
                else { document.getElementById('login-screen').classList.add('hidden'); document.getElementById('profile-modal').classList.remove('hidden'); }
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('app-screen').classList.add('hidden');
            }
        });

        function initApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-screen').classList.remove('hidden');
            document.getElementById('profile-modal').classList.add('hidden');
            if(localStorage.getItem('theme')==='dark') document.body.classList.add('dark');
            
            updateMyProfileUI();
            loadTimeline();
            loadNotifications();
        }

        function updateMyProfileUI() {
            const icon = myProfile.icon || `https://api.dicebear.com/7.x/notionists/svg?seed=${currentUser.uid}`;
            document.getElementById('header-icon').src = icon;
            document.getElementById('input-icon').src = icon;
            document.getElementById('profile-big-icon').src = icon;
            document.getElementById('profile-name').innerText = myProfile.name;
            document.getElementById('profile-uid').innerText = "@"+currentUser.uid.slice(0,8);
            document.getElementById('profile-xp').innerText = myProfile.xp || 0;
            
            // ç§°å·è¡¨ç¤º
            const tEl = document.getElementById('profile-title');
            if(myProfile.title) {
                tEl.innerText = myProfile.title;
                tEl.classList.remove('hidden');
            }
        }

        // --- â˜… æ¼‚æµãƒ­ã‚° (Bottle) æ©Ÿèƒ½ ---
        window.openBottleModal = () => document.getElementById('bottle-modal').classList.remove('hidden');
        
        window.sendBottle = async () => {
            const text = document.getElementById('bottle-input').value;
            if(!text.trim()) return;
            const exp = new Date(); exp.setDate(exp.getDate() + 30); // 30æ—¥ã§æ¶ˆãˆã‚‹
            
            await addDoc(collection(db, "bottles"), {
                text, senderUid: currentUser.uid, senderName: myProfile.name,
                createdAt: serverTimestamp(), expireAt: exp, status: 'unread'
            });
            await updateDoc(doc(db,"users",currentUser.uid), { xp: increment(20) }); // +20XP
            
            alert("æ‰‹ç´™ã‚’æµ·ã«æµã—ã¾ã—ãŸ...(XP+20)");
            document.getElementById('bottle-input').value = "";
            document.getElementById('bottle-modal').classList.add('hidden');
        };

        window.pickupBottle = async () => {
            // ãƒ©ãƒ³ãƒ€ãƒ ã«1ä»¶å–å¾— (ç°¡æ˜“å®Ÿè£…: æ–°ã—ã„é †20ä»¶ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ )
            const q = query(collection(db, "bottles"), where("status", "==", "unread"), orderBy("createdAt", "desc"), limit(20));
            const snap = await getDocs(q);
            
            // è‡ªåˆ†ä»¥å¤–ã®ãƒœãƒˆãƒ«ã‚’æ¢ã™
            const others = snap.docs.filter(d => d.data().senderUid !== currentUser.uid);
            
            if(others.length === 0) {
                alert("ä»Šã¯ãªã«ã‚‚æµã‚Œã¦ã„ãªã„ã‚ˆã†ã§ã™...");
                return;
            }

            const randomDoc = others[Math.floor(Math.random() * others.length)];
            const d = randomDoc.data();

            // UIè¡¨ç¤º
            document.getElementById('bottle-result').classList.remove('hidden');
            document.getElementById('bottle-text').innerText = d.text;
            document.getElementById('bottle-date').innerText = new Date(d.createdAt.toDate()).toLocaleDateString();
            
            // æ—¢èª­ã«ã™ã‚‹ (ä»–ã®äººã¯æ‹¾ãˆãªããªã‚‹)
            await updateDoc(doc(db, "bottles", randomDoc.id), { status: 'read', pickerUid: currentUser.uid });
        };

        // --- â˜… ç§°å·ã‚¬ãƒãƒ£ (Gacha) æ©Ÿèƒ½ ---
        window.spinGacha = async () => {
            if((myProfile.xp || 0) < 50) return alert("XPãŒè¶³ã‚Šã¾ã›ã‚“ (å¿…è¦: 50 XP)");
            if(!confirm("50 XPã‚’ä½¿ã£ã¦ç§°å·ã‚¬ãƒãƒ£ã‚’å›ã—ã¾ã™ã‹ï¼Ÿ")) return;

            const newTitle = TITLES[Math.floor(Math.random() * TITLES.length)];
            await updateDoc(doc(db, "users", currentUser.uid), { 
                xp: increment(-50),
                title: newTitle 
            });
            myProfile.xp -= 50;
            myProfile.title = newTitle;
            updateMyProfileUI();
            alert(`ğŸ‰ GET!! ç§°å·: [${newTitle}]`);
        };

        // --- Timeline & Post ---
        document.getElementById('post-btn').onclick = async () => {
            const text = document.getElementById('post-text').value; if(!text.trim()) return;
            const exp = new Date(); exp.setDate(exp.getDate() + 90);
            await addDoc(collection(db,"logs"), { text, uid: currentUser.uid, authorName: myProfile.name, authorIcon: myProfile.icon, createdAt: serverTimestamp(), expireAt: exp, likes: [] });
            await updateDoc(doc(db,"users",currentUser.uid), { xp: increment(10) });
            document.getElementById('post-text').value="";
        };

        function loadTimeline() {
            onSnapshot(query(collection(db,"logs"), orderBy("createdAt","desc"), limit(50)), (snap) => {
                const c = document.getElementById('timeline'); c.innerHTML = "";
                snap.forEach(d => c.innerHTML += buildPostHTML(d.id, d.data()));
            });
            loadMyPosts();
        }

        function loadMyPosts() {
            onSnapshot(query(collection(db,"logs"), where("uid","==",currentUser.uid), orderBy("createdAt","desc"), limit(20)), (s) => {
                const c = document.getElementById('my-timeline'); c.innerHTML = "";
                s.forEach(d => c.innerHTML += buildPostHTML(d.id, d.data()));
            });
        }

        function buildPostHTML(id, d) {
            const isLiked = d.likes && d.likes.includes(currentUser.uid);
            return `
                <div class="post-card flex gap-3 hover:bg-gray-50 dark:hover:bg-gray-900/30 transition">
                    <img src="${d.authorIcon}" class="w-10 h-10 rounded-full object-cover flex-shrink-0">
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-baseline">
                            <span class="font-bold text-[15px] truncate">${d.authorName}</span>
                            <span class="text-[var(--subtext)] text-xs">@${d.uid.slice(0,8)}</span>
                        </div>
                        <p class="text-[15px] mt-1 whitespace-pre-wrap leading-relaxed">${d.text}</p>
                        <div class="flex justify-end mt-2">
                            <button onclick="like('${id}')" class="btn-ghost ${isLiked?'like-active':''}"><span class="material-icons-round text-lg">${isLiked?'favorite':'favorite_border'}</span> <span class="text-xs ml-1">${d.likes?d.likes.length:0}</span></button>
                        </div>
                    </div>
                </div>`;
        }

        window.like = async (id) => {
            const r = doc(db,"logs",id); const d=(await getDoc(r)).data();
            if(d.likes.includes(currentUser.uid)) await updateDoc(r,{likes:arrayRemove(currentUser.uid)});
            else await updateDoc(r,{likes:arrayUnion(currentUser.uid)});
        };

        // Notifications
        function loadNotifications() {
            // Beta 6+
        }

        // Common
        window.saveProfile = async () => { const n=document.getElementById('edit-name-input').value; if(!n)return; await setDoc(doc(db,"users",currentUser.uid),{name:n,icon:`https://api.dicebear.com/7.x/notionists/svg?seed=${currentUser.uid}`,xp:0},{merge:true}); location.reload(); };
        window.toggleDarkMode = () => { document.body.classList.toggle('dark'); localStorage.setItem('theme',document.body.classList.contains('dark')?'dark':'light'); };
        window.openSettings = () => document.getElementById('settings-modal').classList.remove('hidden');
        window.signOutApp = () => signOut(auth);
        window.switchTab = (t) => { ['home','bottle','notif','profile'].forEach(x => document.getElementById(`tab-${x}`).classList.add('hidden')); document.getElementById(`tab-${t}`).classList.remove('hidden'); document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('nav-active')); const b = document.querySelector(`.nav-item[data-target="${t}"]`); if(b) b.classList.add('nav-active'); };
    </script>
</body>
</html>
